# CE Framework - Unified Configuration v1.1
# Single source of truth for init-project pipeline

version: "1.1"

# Project profile
profile:
  project_name: "ctx-eng-plus"
  description: "Context Engineering framework and tools"
  linear:
    project: "Context Engineering"
    assignee: "blazej.przybyszewski@gmail.com"
    team: "Blaise78"

# File discovery: domains with legacy locations
detection:
  domains:
    prps:
      paths: [PRPs/, context-engineering/PRPs/, context-engineering/]
      patterns: ["**/*.md"]
    examples:
      paths: [examples/, context-engineering/examples/, context-engineering/]
      patterns: ["**/*.md", "**/*.py"]
    claude_md:
      paths: [CLAUDE.md]
      patterns: ["CLAUDE.md"]
    settings:
      paths: [.claude/settings.local.json]
      patterns: ["settings.local.json"]
    commands:
      paths: [.claude/commands/]
      patterns: ["**/*.md"]
    memories:
      paths: [.serena/memories/]
      patterns: ["**/*.md"]

# Directory paths: output, framework, and legacy locations
directories:
  # Where framework files go in target (output) and come from after extraction (framework)
  paths:
    ce_root: .ce/
    claude_dir: .claude/
    claude_commands: .claude/commands/
    settings: .claude/settings.local.json
    claude_md: CLAUDE.md
    serena: .serena/
    serena_memories: .serena/memories/
    examples: .ce/examples/
    prps: .ce/PRPs/
    tools: .ce/tools/

  # Legacy directories to clean up after migration
  legacy: [PRPs/, examples/, context-engineering/, .serena.old/, .ce.old/]

# Blending: How to merge framework + user files
blending:
  domains:
    prps:
      strategy: move-all
      dedup: content-hash
    examples:
      strategy: dedupe-copy
      dedup: nl-similarity
      skip_cleanup: true
    memories:
      strategy: nl-blend
      critical: [code-style-conventions.md, task-completion-checklist.md, testing-standards.md, tool-usage-syntropy.md, use-syntropy-tools-not-bash.md, suggested-commands.md]
    claude_md:
      strategy: nl-blend
    settings:
      strategy: rule-based
      rules: [ce_deny_wins, merge_lists, single_membership]
    commands:
      strategy: overwrite
      backup: true

  llm:
    api_key_env: ANTHROPIC_API_KEY
    timeout: 60
    max_retries: 3
    draft_model: claude-3-5-haiku-20241022
    merge_model: claude-sonnet-4-5-20250929
    similarity_threshold: 0.9

# Cleanup: Safe removal with migration verification
cleanup:
  strategy: safe
  verify_before_cleanup: true
  legacy_dirs:
    PRPs: {required_migration: true}
    examples: {required_migration: false}
    context-engineering: {required_migration: true, root_files: true}
    .serena.old: {required_migration: false}
    .ce.old: {required_migration: false}

# Repomix package composition
repomix:
  infrastructure:
    output: ce-32/builds/ce-infrastructure.xml
    include:
      - .ce/config.yml
      - .ce/PRPs/executed/system/PRP-0-CONTEXT-ENGINEERING.md
      - .serena/memories/**
      - .claude/**/*.md
      - tools/ce/**/*.py
      - tools/pyproject.toml
      - tools/bootstrap.sh
      - .claude/settings.local.json
      - CLAUDE.md
      - .ce/blend-config.yml
      - examples/**/*.md
      - examples/**/*.py
    exclude: [".git/**", ".tmp/**", "**/__pycache__/**", "*.pyc", "tools/tests/**"]

# Pipeline phases with timeouts
pipeline:
  phases:
    extract: {timeout: 120, description: Extract framework files from XML}
    blend: {timeout: 600, description: Merge framework + user files}
    initialize: {timeout: 300, description: Setup Python environment}
    verify: {timeout: 30, description: Validate installation}

# Validation gates
validation_gates:
  gate_1:
    name: Framework Structure
    checks: [test -d .ce/examples/, test -d .ce/PRPs/, test -d .serena/memories/, test ! -d .ce/.claude, test ! -d .ce/.serena]
  gate_2:
    name: Examples Migration
    checks: [test -d .ce/examples/]
  gate_3:
    name: PRPs Migration
    checks: [test -d .ce/PRPs/, test ! -d PRPs/]
  gate_4:
    name: Memories Domain
    checks: [test -d .serena/memories/, test ! -d .ce/.serena, find .serena/memories -name '*.md' | wc -l >= 24]
  gate_5:
    name: Critical Memories
    checks: [test -f .serena/memories/code-style-conventions.md, test -f .serena/memories/task-completion-checklist.md, test -f .serena/memories/testing-standards.md]
